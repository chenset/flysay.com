<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>Fly Say</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="canonical" href="https://flysay.com"/>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <style>
        * {
            padding: 0;
            margin: 0;
            -webkit-box-sizing: border-box;
        }

        body {
            font-family: Helvetica, Arial, sans-serif, "Microsoft YaHei", 'Helvetica Neue';
            color: #333;
            font-size: 14px;
        }

        *:focus {
            outline: none;
        }

        ::selection {
            background: #efefef;
        }

        a {
            color: #000;
            text-decoration: none;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 400;
            margin: 15px 0;
        }

        input {
            -webkit-appearance: none;
            border-radius: 0;
        }

        a:hover, a:focus {
            color: #444;
        }

        li {
            list-style: none;
        }

        .main-wrap {
            width: 100%;
            padding: 0 30px;
            position: absolute;
            top: 50%;
            margin-top: -90px;
            text-align: center;
            z-index: 2;
        }

        .main-header {
            display: inline-block;
            text-align: left;
            margin-left: auto;
            margin-right: auto;
            background: #FFF;
            padding: 2px 20px 10px;
            opacity: 0.9;
        }

        .site-menu {
            border-top: 1px solid #f1f1f1;
        }

        .site-menu li {
            float: left;
            line-height: 14px;
            font-size: 14px;
            padding: 10px 40px 10px 0;
        }

        .site-menu li:last-child {
            padding-right: 0;
        }

        @keyframes fadein {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .lds-dual-ring {
            display: none;
            position: absolute;
            z-index: 1000;
        }

        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 36px;
            height: 36px;
            margin: 1px;
            border-radius: 50%;
            border: 4px solid #fff;
            border-color: #fff transparent #fff transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }

        @keyframes lds-dual-ring {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

    </style>
</head>
<body>
<div class="main-wrap">
    <header class="main-header">
        <div class="container">
            <div style="font-size:14px;color: #ff5252;padding:5px 10px;float: right;cursor: pointer;animation: fadein 3s"
                 id="switch">+
            </div>
            <h2 class="main-logo-wrap">
                <a id="main-logo" href="/">
                    <span style="color:#ff5252">F</span><span style="color:#cc9966">l</span><span
                        style="color:#41B883">y</span> <span style="color:#01AAED">S</span><span
                        style="color:#cc9966">a</span><span style="color:#41B883">y</span>
                </a>
            </h2>
            <nav class="site-menu">
                <ul>
                    <li><a href="https://blog.flysay.com/">BLOG</a></li>
                    <li><a href="https://str.flysay.com/">字幕文件重命名</a></li>
                    <li><a href="https://har2jmx.flysay.com/">HAR2JMX</a></li>
                    <li><a href="https://sensor.flysay.com/">SENSOR</a></li>
                    <li><a href="https://asuka.flysay.com/">ASUKA</a></li>
                    <li><a href="https://github.com/chenset">GITHUB</a></li>
                </ul>
            </nav>
        </div>
    </header>
</div>

<div style="height:100%;width:100%;position: absolute;z-index: 1;overflow: hidden;display:none;animation: fadein 2s;"
     id="img-wrap">
    <img id="img-el"
         style="cursor:pointer;max-width: 100%;min-width:1400px;height:auto;display: block;margin: 0 auto;position: relative;"/>
</div>

<div style="display:none;position:fixed;z-index: 999;width: 100%;height: 100%;background: none;" id="layer"></div>
<div class="lds-dual-ring" id="loading"></div>

<footer id="exif-wrap"
        style="position: fixed;bottom: 0;left:0;z-index: 2;background: #FFF; opacity: 0.8;padding:2px 6px;font-size: 10px;display: none;animation: fadein 2s;">
    <span id="exif-date"></span>
    <a style="margin-left: 6px" target="_blank" id="exif-google-map">Map</a>
</footer>
<script>
    let imagePaths, imgStorage = [
        'https://h.flysay.com/',
        'https://pages.flysay.com/',
        'https://img.flysay.com/',
        '/',
    ], img = document.getElementById("img-el");

    function randomImagePath() {
        return imagePaths[Math.floor(Math.random() * imagePaths.length)].path;
    }

    function start() {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {
                try {
                    imagePaths = JSON.parse(this.responseText);
                    loadImg();
                } catch (e) {
                }
            }
        };
        xhr.open("GET", "https://api.github.com/repositories/186582306/contents/images", true);
        xhr.setRequestHeader("Authorization", "token" + " 12a1f8bf43883b5db6ca562" + "2c046f516" + "0d5dc7e6"); // + for hack
        xhr.send();
    }

    document.getElementById('switch').addEventListener('click', function () {
        if (this.getAttribute('data-click-flag')) {
            document.getElementsByClassName('main-wrap')[0].style.display = 'none';
        } else {
            start();
        }
        this.style.transform = 'rotate(45deg)';
        this.setAttribute('data-click-flag', '1');
    });

    window.addEventListener('resize', function () {
        clearTimeout(window.resizeTimer);
        window.resizeTimer = setTimeout(function () {
            imgPosition();
        }, 100);
    });

    img.addEventListener('click', showLoading, true);
    img.addEventListener('click', loadImg);
    img.addEventListener('error', function () {
        if (imgStorage.length) {
            imgStorage.shift();
            loadImg();
        }
    });
    img.addEventListener('load', function () {
        hidenLoading();
        document.getElementById('img-wrap').style.display = 'block';
        imgPosition();
        loadScriptOnce('exif.js', function () {
            img.exifdata = null;
            EXIF.getData(img, function () {
                let info = EXIF.getAllTags(this);
                if (info.hasOwnProperty('GPSLatitude') && info.GPSLatitude.length) {
                    document.getElementById('exif-wrap').style.display = 'block';
                    let latitude = (info.GPSLatitude[0] + info.GPSLatitude[1] / 60 + info.GPSLatitude[2] / 3600).toFixed(7),
                        longitude = (info.GPSLongitude[0] + info.GPSLongitude[1] / 60 + info.GPSLongitude[2] / 3600).toFixed(7);
                    document.getElementById('exif-date').innerText = info.DateTime;
                    document.getElementById('exif-google-map').href = "https://maps.google.com/?q=" + latitude + "," + longitude + "&ll=" + latitude + "," + longitude + "&z=18";
                }
            });
        });
    });

    function showLoading(e) {
        let loading = document.getElementById('loading');
        document.getElementById('layer').style.display = 'block';
        loading.style.display = 'block';
        let rect = document.documentElement.getBoundingClientRect(),
            x = e.clientX - rect.left,
            y = e.clientY - rect.top;
        loading.style.top = y - loading.offsetHeight / 2 + "px";
        loading.style.left = x - loading.offsetWidth / 2 + "px";
    }

    function hidenLoading() {
        document.getElementById('layer').style.display = 'none';
        document.getElementById('loading').style.display = 'none';
    }

    function loadImg() {
        if (imgStorage.length) {
            img.src = imgStorage[0] + randomImagePath();
        }
    }

    function imgPosition() {
        if (img.clientWidth > window.innerWidth) {
            img.style.left = (-(img.clientWidth - window.innerWidth) / 2) + "px";
        } else {
            img.style.left = "0";
        }
        img.style.top = (-(img.clientHeight - window.innerHeight) / 2) + "px";
    }

    function loadScriptOnce(src, callback) {
        window.scriptSrcArrays = window.scriptSrcArrays ? window.scriptSrcArrays : [];
        for (let i = 0; i < window.scriptSrcArrays.length; i++) {
            if (window.scriptSrcArrays[i] === src) {
                callback && callback();
                return;
            }
        }
        window.scriptSrcArrays.push(src);
        let script = document.createElement('script');
        script.onload = function () {
            script.onload = null;
            callback && callback();
        };
        script.src = src;
        document.getElementsByTagName('head')[0].appendChild(script);
    }
</script>
</body>
</html>
